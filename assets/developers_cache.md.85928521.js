import{_ as s,o as a,c as l,U as n}from"./chunks/framework.906c2817.js";const A=JSON.parse('{"title":"캐시 (Cache)","description":"","frontmatter":{},"headers":[],"relativePath":"developers/cache.md","filePath":"developers/cache.md","lastUpdated":1689099667000}'),p={name:"developers/cache.md"},o=n(`<h1 id="캐시-cache" tabindex="-1">캐시 (Cache) <a class="header-anchor" href="#캐시-cache" aria-label="Permalink to &quot;캐시 (Cache)&quot;">​</a></h1><p>TBD</p><p>DB에서 가져온 값이나 가공된 값을 캐시에 담아두고 빠르게 재사용할 수 있다. 그누보드에서는 현재 최근게시물 위젯의 캐시만 사용하고 있다.</p><p>클래스 객체의 멤버 변수를 이용한 Object Cache와 파일을 이용한 캐시를 지원하며 파일 캐시는 사용자가 다른 수단으로 대체할 수 있다.</p><h2 id="오브젝트-캐시" tabindex="-1">오브젝트 캐시 <a class="header-anchor" href="#오브젝트-캐시" aria-label="Permalink to &quot;오브젝트 캐시&quot;">​</a></h2><p>오브젝트 캐시는 접속자의 세션에서만 유지된다. 즉, 휘발성이다. <a href="/developers/polluted_variables.html">전역변수의 오염</a>을 방지하고 공유하는 용도로 사용할 수 있다.</p><p>오브젝트 캐시는 <code>type</code>으로 분류되며 <code>bbs</code> 또는 <code>content</code> 두 가지 타입을 지원 한다. <code>bbs</code>는 게시판의 글의 데이터, <code>content</code>는 &#39;게시판 관리 -&gt; 내용관리&#39;의 데이터가 저장된다.</p><p><code>type</code>의 하위 분류로 <code>group</code>을 지정할 수 있으며 group을 지정하지 않으면 <code>default</code> 그룹 이름으로 분류된다.</p><p><code>G5_object_cache</code> 클래스로 이용할 수 있지만, 단일 인스턴스를 위해 <code>$g5_object</code> 전역변수를 사용해야 한다.</p><h3 id="set" tabindex="-1">set() <a class="header-anchor" href="#set" aria-label="Permalink to &quot;set()&quot;">​</a></h3><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>bbs</code>, <code>content</code> 외의 커스텀 타입은 임의의 공통 타입으로 지정되어 사실상 타입 지정이 무시되어 구분되지 않으므로 주의해야 한다. group과 key를 고유한 이름으로 지정해야한다.</p></div><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 게시물 타입 예시</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[];</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">g5_object</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">set</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bbs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">wr_id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bo_table</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 커스텀 타입 예시</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">type </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">my_plugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">key </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">config1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[];</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">g5_object</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">set</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">my_plugin_config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span></span></code></pre></div><h3 id="get" tabindex="-1">get() <a class="header-anchor" href="#get" aria-label="Permalink to &quot;get()&quot;">​</a></h3><p>캐시에 저장된 데이터를 반환하고, 저장된 데이터가 없으면 <code>false</code>를 반환 한다.</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 게시물 데이터 가져오기</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 게시물은 세번째 인자인 그룹은 게시판 ID(bo_table)를 지정해야 한다</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">g5_object</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bbs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">wr_id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bo_table</span><span style="color:#89DDFF;">);</span></span></code></pre></div><p>캐시에서 가져온 데이터를 변경 후 캐시 데이터에도 반영하려면 변경한 데이터를 캐시에 다시 저장해야 한다.</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">wr_subject</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">str_replace</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&amp;nbsp;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">wr_subject</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]);</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">g5_object</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">set</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bbs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">wr_id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bo_table</span><span style="color:#89DDFF;">);</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>값으로 <code>false</code>를 저장하면 데이터가 없는 상태(<code>false</code>)와 구분하지 못하므로 귀찮아도 배열에 담아 저장해두는 것이 좋다.</p></div><h3 id="exists" tabindex="-1">exists() <a class="header-anchor" href="#exists" aria-label="Permalink to &quot;exists()&quot;">​</a></h3><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exists</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">group </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span></span></code></pre></div><h3 id="delete" tabindex="-1">delete() <a class="header-anchor" href="#delete" aria-label="Permalink to &quot;delete()&quot;">​</a></h3><p>현재 버그<sup><a href="https://github.com/gnuboard/gnuboard5/issues/225" target="_blank" rel="noreferrer">#255</a></sup>로 인해 동작하지 않는다.</p><h2 id="파일-캐시" tabindex="-1">파일 캐시 <a class="header-anchor" href="#파일-캐시" aria-label="Permalink to &quot;파일 캐시&quot;">​</a></h2><p>파일 캐시는 오브젝트 캐시와 달리 파일에 저장하고 모든 접속자의 세션에서 공유하여 사용할 수 있다.</p><p>캐시를 저장할 때 유지시간(TTL)을 지정하여 자동으로 만료시킬 수 있으며, TTL을 설정하지 않았더라도 데이터를 가져올 때 <code>$expired_time</code>을 지정하여 만료시킬 수 있다.</p><p>데이터를 가져올 때 지정하는 <code>$expired_time</code>은 목적에 따라 캐시를 만료시키는 상황을 분리할 수 있다. 예로,</p><h3 id="g5-set-cache" tabindex="-1">g5_set_cache() <a class="header-anchor" href="#g5-set-cache" aria-label="Permalink to &quot;g5_set_cache()&quot;">​</a></h3><p><code>$ttl</code>을 지정하면 지정된 시간(초 단위)이 지나면 자동으로 만료된다. TTL은 선택사항이며 지정하지 않으면 자동으로 만료되지 않는다.</p><p>오브젝트 캐시와 마찬가지로 값으로 <code>false</code>를 저장하면 캐시가 없거나 만료된 상태와 구분할 수 없으므로 주의해야 한다.</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 데이터 저장</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">key </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">my_plugin_cache_data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">save_data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">array</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">ttl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 초(second)</span></span>
<span class="line"><span style="color:#82AAFF;">g5_set_cache</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">save_data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">ttl</span><span style="color:#89DDFF;">);</span></span></code></pre></div><details class="details custom-block"><summary>Details</summary><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#F78C6C;font-style:italic;">string</span><span style="color:#676E95;font-style:italic;"> $key</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#F78C6C;font-style:italic;">mixed</span><span style="color:#676E95;font-style:italic;"> $save_data</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#F78C6C;font-style:italic;">@param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#F78C6C;font-style:italic;">int</span><span style="color:#676E95;font-style:italic;"> $ttl 초 단위</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#F78C6C;font-style:italic;">@return</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#F78C6C;font-style:italic;">false</span><span style="color:#89DDFF;font-style:italic;">|</span><span style="color:#F78C6C;font-style:italic;">mixed</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_set_cache</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">save_data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">ttl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null);</span></span></code></pre></div></details><h3 id="g5-get-cache" tabindex="-1">g5_get_cache() <a class="header-anchor" href="#g5-get-cache" aria-label="Permalink to &quot;g5_get_cache()&quot;">​</a></h3><p>파일 캐시에서 데이터를 가져온다. 저장된 데이터가 없거나 만료되었다면 <code>false</code>를 반환 한다.</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">myPluginConfig </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_get_cache</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 캐시에서 데이터를 가져오지 못하면 DB에서 가져오기</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">myPluginConfig </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// $myPluginConfig = ...;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><code>$expired_time</code>은 초(second) 단위로 지정할 수 있으며, 현재로부터 n초 이내의 데이터만 유지되며 그 이전의 캐시는 만료시킨다.</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">expired_time </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 초 단위</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">myPluginConfig </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_get_cache</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">expired_time</span><span style="color:#89DDFF;">);</span></span></code></pre></div><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_set_cache</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">save_data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">ttl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null);</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_get_cache</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">expired_time</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_delete_cache</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_delete_all_cache</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g5_delete_cache_by_prefix</span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">);</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>그누보드의 데이터는 예상하거나 감지할 수 없는 변경이 발생할 수 있어 캐시를 제때 갱신하지 못할 수 있다. 데이터를 가져오거나 저장하는 인터페이스가 거의 제공되지 않기 때문에 통제되지 않는 데이터 변경이 예상된다면 캐시를 사용하지 않는 것을 권장한다.</p></div><h3 id="확장하기" tabindex="-1">확장하기 <a class="header-anchor" href="#확장하기" aria-label="Permalink to &quot;확장하기&quot;">​</a></h3><ul><li><p>function get_cachemanage_instance()</p></li><li><p><a href="https://sir.kr/g5_plugin/8665" target="_blank" rel="noreferrer">https://sir.kr/g5_plugin/8665</a></p></li></ul>`,40),e=[o];function t(c,r,D,y,F,i){return a(),l("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
